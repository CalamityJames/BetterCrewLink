{"version":3,"file":"Voice.js","sourceRoot":"","sources":["Voice.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useMemo, useRef, useState } from 'react';\r\nimport io, { Socket } from 'socket.io-client';\r\nimport Avatar from './Avatar';\r\nimport { GameStateContext, LobbySettingsContext, PlayerColorContext, SettingsContext } from './contexts';\r\nimport {\r\n\tAmongUsState,\r\n\tGameState,\r\n\tPlayer,\r\n\tSocketClientMap,\r\n\tAudioConnected,\r\n\tClientBoolMap,\r\n\tnumberStringMap,\r\n\tClient,\r\n\tVoiceState,\r\n} from '../common/AmongUsState';\r\nimport Peer from 'simple-peer';\r\nimport { ipcRenderer } from 'electron';\r\nimport VAD from './vad';\r\nimport { ISettings, playerConfigMap, ILobbySettings } from '../common/ISettings';\r\nimport { IpcRendererMessages, IpcMessages, IpcOverlayMessages, IpcHandlerMessages } from '../common/ipc-messages';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport makeStyles from '@material-ui/core/styles/makeStyles';\r\nimport SupportLink from './SupportLink';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport { validateClientPeerConfig } from './validateClientPeerConfig';\r\n// @ts-ignore\r\nimport reverbOgx from 'arraybuffer-loader!../../static/sounds/reverb.ogx'; // @ts-ignore\r\nimport radioOnSound from '../../static/sounds/radio_on.wav'; // @ts-ignore\r\n// import radioBeep2 from '../../static/sounds/radio_beep2.wav';\r\n\r\nimport { CameraLocation, AmongUsMaps, MapType } from '../common/AmongusMap';\r\nimport Store from 'electron-store';\r\nimport { ObsVoiceState } from '../common/ObsOverlay';\r\n// import { poseCollide } from '../common/ColliderMap';\r\nimport Footer from './Footer';\r\nimport Button from '@material-ui/core/Button';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport VolumeOff from '@material-ui/icons/VolumeOff';\r\nimport VolumeUp from '@material-ui/icons/VolumeUp';\r\nimport Mic from '@material-ui/icons/Mic';\r\nimport MicOff from '@material-ui/icons/MicOff';\r\nimport adapter from 'webrtc-adapter';\r\nimport { VADOptions } from './vad';\r\nimport { pushToTalkOptions } from './settings/Settings';\r\nimport { poseCollide } from '../common/ColliderMap';\r\n\r\nconsole.log(adapter.browserDetails.browser);\r\n\r\nexport interface ExtendedAudioElement extends HTMLAudioElement {\r\n\tsetSinkId: (sinkId: string) => Promise<void>;\r\n}\r\n\r\ninterface PeerConnections {\r\n\t[peer: string]: Peer.Instance;\r\n}\r\n\r\ninterface VadNode {\r\n\tconnect: () => void;\r\n\tdestroy: () => void;\r\n\toptions: VADOptions;\r\n\tinit: () => void;\r\n}\r\n\r\ninterface AudioNodes {\r\n\tdummyAudioElement: HTMLAudioElement;\r\n\taudioElement: HTMLAudioElement;\r\n\tgain: GainNode;\r\n\tpan: PannerNode;\r\n\treverb: ConvolverNode;\r\n\tmuffle: BiquadFilterNode;\r\n\tdestination: AudioNode;\r\n\treverbConnected: boolean;\r\n\tmuffleConnected: boolean;\r\n}\r\n\r\ninterface AudioElements {\r\n\t[peer: string]: AudioNodes;\r\n}\r\n\r\ninterface ConnectionStuff {\r\n\tsocket?: typeof Socket;\r\n\toverlaySocket?: typeof Socket;\r\n\tstream?: MediaStream;\r\n\tinstream?: MediaStream;\r\n\r\n\tmicrophoneGain?: GainNode;\r\n\taudioListener?: VadNode;\r\n\tpushToTalkMode: number;\r\n\tdeafened: boolean;\r\n\tmuted: boolean;\r\n\timpostorRadio: boolean | null;\r\n\ttoggleMute: () => void;\r\n\ttoggleDeafen: () => void;\r\n}\r\n\r\ninterface SocketError {\r\n\tmessage?: string;\r\n}\r\n\r\ninterface ClientPeerConfig {\r\n\tforceRelayOnly: boolean;\r\n\ticeServers: RTCIceServer[];\r\n}\r\n\r\nconst DEFAULT_ICE_CONFIG: RTCConfiguration = {\r\n\ticeTransportPolicy: 'all',\r\n\ticeServers: [\r\n\t\t{\r\n\t\t\turls: 'stun:stun.l.google.com:19302',\r\n\t\t},\r\n\t],\r\n};\r\n\r\nconst DEFAULT_ICE_CONFIG_TURN: RTCConfiguration = {\r\n\ticeTransportPolicy: 'relay',\r\n\ticeServers: [\r\n\t\t{\r\n\t\t\turls: 'turn:turn.bettercrewl.ink:3478',\r\n\t\t\tusername: 'M9DRVaByiujoXeuYAAAG',\r\n\t\t\tcredential: 'TpHR9HQNZ8taxjb3',\r\n\t\t},\r\n\t],\r\n};\r\n\r\nexport interface VoiceProps {\r\n\tt: (key: string) => string;\r\n\terror: string;\r\n}\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n\terror: {\r\n\t\tposition: 'absolute',\r\n\t\ttop: '50%',\r\n\t\ttransform: 'translateY(-50%)',\r\n\t},\r\n\troot: {\r\n\t\tpaddingTop: theme.spacing(3),\r\n\t},\r\n\ttop: {\r\n\t\tdisplay: 'flex',\r\n\t\tjustifyContent: 'center',\r\n\t\talignItems: 'center',\r\n\t},\r\n\tright: {\r\n\t\tdisplay: 'flex',\r\n\t\tflexDirection: 'column',\r\n\t\talignItems: 'center',\r\n\t\tjustifyContent: 'center',\r\n\t},\r\n\tusername: {\r\n\t\tdisplay: 'block',\r\n\t\ttextAlign: 'center',\r\n\t\tfontSize: 20,\r\n\t\twhiteSpace: 'nowrap',\r\n\t},\r\n\tcode: {\r\n\t\tfontFamily: \"'Source Code Pro', monospace\",\r\n\t\tdisplay: 'block',\r\n\t\twidth: 'fit-content',\r\n\t\tmargin: '5px auto',\r\n\t\tpadding: 5,\r\n\t\tborderRadius: 5,\r\n\t\tfontSize: 28,\r\n\t},\r\n\totherplayers: {\r\n\t\twidth: 225,\r\n\t\theight: 225,\r\n\t\tmargin: '4px auto',\r\n\t\t'& .MuiGrid-grid-xs-1': {\r\n\t\t\tmaxHeight: '8.3333333%',\r\n\t\t},\r\n\t\t'& .MuiGrid-grid-xs-2': {\r\n\t\t\tmaxHeight: '16.666667%',\r\n\t\t},\r\n\t\t'& .MuiGrid-grid-xs-3': {\r\n\t\t\tmaxHeight: '25%',\r\n\t\t},\r\n\t\t'& .MuiGrid-grid-xs-4': {\r\n\t\t\tmaxHeight: '33.333333%',\r\n\t\t},\r\n\t},\r\n\tavatarWrapper: {\r\n\t\twidth: 80,\r\n\t\tpadding: theme.spacing(1),\r\n\t},\r\n\tmuteButtons: {\r\n\t\tpaddingLeft: '5px',\r\n\t\tpaddingTop: '26px',\r\n\t\tfloat: 'right',\r\n\t\tdisplay: 'grid',\r\n\t},\r\n\tleft: { float: 'left' },\r\n}));\r\n\r\nconst defaultlocalLobbySettings: ILobbySettings = {\r\n\tmaxDistance: 5.32,\r\n\thaunting: false,\r\n\thearImpostorsInVents: false,\r\n\timpostersHearImpostersInvent: false,\r\n\timpostorRadioEnabled: false,\r\n\tcommsSabotage: false,\r\n\tdeadOnly: false,\r\n\thearThroughCameras: false,\r\n\twallsBlockAudio: false,\r\n\tmeetingGhostOnly: false,\r\n\tvisionHearing: false,\r\n\tpublicLobby_on: false,\r\n\tpublicLobby_title: '',\r\n\tpublicLobby_language: 'en',\r\n};\r\nconst radioOnAudio = new Audio();\r\nradioOnAudio.src = radioOnSound;\r\nradioOnAudio.volume = 0.02;\r\n\r\n// const radiobeepAudio2 = new Audio();\r\n// radiobeepAudio2.src = radioBeep2;\r\n// radiobeepAudio2.volume = 0.2;\r\n\r\nconst store = new Store<ISettings>();\r\nconst Voice: React.FC<VoiceProps> = function ({ t, error: initialError }: VoiceProps) {\r\n\tconst [error, setError] = useState('');\r\n\tconst [settings] = useContext(SettingsContext);\r\n\r\n\tconst settingsRef = useRef<ISettings>(settings);\r\n\tconst [lobbySettings, setLobbySettings] = useContext(LobbySettingsContext);\r\n\tconst lobbySettingsRef = useRef(lobbySettings);\r\n\tconst maxDistanceRef = useRef(2);\r\n\tconst gameState = useContext(GameStateContext);\r\n\tconst playerColors = useContext(PlayerColorContext);\r\n\r\n\tconst hostRef = useRef({\r\n\t\tmap: MapType.UNKNOWN,\r\n\t\tmobileRunning: false,\r\n\t\tgamestate: gameState.gameState,\r\n\t\tcode: gameState.lobbyCode,\r\n\t\thostId: gameState.hostId,\r\n\t\tparsedHostId: gameState.hostId,\r\n\t\tisHost: gameState.isHost,\r\n\t\tserverHostId: 0,\r\n\t});\r\n\tlet { lobbyCode: displayedLobbyCode } = gameState;\r\n\tif (displayedLobbyCode !== 'MENU' && settings.hideCode) displayedLobbyCode = 'LOBBY';\r\n\tconst [talking, setTalking] = useState(false);\r\n\tconst [socketClients, setSocketClients] = useState<SocketClientMap>({});\r\n\tconst [playerConfigs] = useState<playerConfigMap>(settingsRef.current.playerConfigMap);\r\n\tconst socketClientsRef = useRef(socketClients);\r\n\tconst [peerConnections, setPeerConnections] = useState<PeerConnections>({});\r\n\tconst convolverBuffer = useRef<AudioBuffer | null>(null);\r\n\tconst playerSocketIdsRef = useRef<numberStringMap>({});\r\n\tconst classes = useStyles();\r\n\r\n\tconst [connect, setConnect] = useState<{\r\n\t\tconnect: (lobbyCode: string, playerId: number, clientId: number, isHost: boolean) => void;\r\n\t} | null>(null);\r\n\tconst [otherTalking, setOtherTalking] = useState<ClientBoolMap>({});\r\n\tconst [otherVAD, setOtherVAD] = useState<ClientBoolMap>({});\r\n\r\n\tconst [otherDead, setOtherDead] = useState<ClientBoolMap>({});\r\n\tconst impostorRadioClientId = useRef<number>(-1);\r\n\r\n\tconst audioElements = useRef<AudioElements>({});\r\n\tconst [audioConnected, setAudioConnected] = useState<AudioConnected>({});\r\n\r\n\tconst [deafenedState, setDeafened] = useState(false);\r\n\tconst [mutedState, setMuted] = useState(false);\r\n\tconst [connected, setConnected] = useState(false);\r\n\r\n\tfunction applyEffect(gain: AudioNode, effectNode: AudioNode, destination: AudioNode, player: Player) {\r\n\t\tconsole.log('Apply effect->', effectNode);\r\n\t\ttry {\r\n\t\t\tgain.disconnect(destination);\r\n\t\t\tgain.connect(effectNode);\r\n\t\t\teffectNode.connect(destination);\r\n\t\t} catch {\r\n\t\t\tconsole.log('error with applying effect: ', player.name, effectNode);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction restoreEffect(gain: AudioNode, effectNode: AudioNode, destination: AudioNode, player: Player) {\r\n\t\tconsole.log('restore effect->', effectNode);\r\n\t\ttry {\r\n\t\t\teffectNode.disconnect(destination);\r\n\t\t\tgain.disconnect(effectNode);\r\n\t\t\tgain.connect(destination);\r\n\t\t} catch {\r\n\t\t\tconsole.log('error with applying effect: ', player.name, effectNode);\r\n\t\t}\r\n\t}\r\n\tfunction calculateVoiceAudio(\r\n\t\tstate: AmongUsState,\r\n\t\tsettings: ISettings,\r\n\t\tme: Player,\r\n\t\tother: Player,\r\n\t\taudio: AudioNodes\r\n\t): number {\r\n\t\tconst { pan, gain, muffle, reverb, destination } = audio;\r\n\t\tconst audioContext = pan.context;\r\n\t\tconst useLightSource = true;\r\n\t\tlet maxdistance = maxDistanceRef.current;\r\n\t\tlet panPos = [other.x - me.x, other.y - me.y];\r\n\t\tlet endGain = 0;\r\n\t\tlet collided = false;\r\n\t\tlet skipDistanceCheck = false;\r\n\t\tlet muffleEnabled = false;\r\n\r\n\t\tif (other.disconnected || other.isDummy) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tswitch (state.gameState) {\r\n\t\t\tcase GameState.MENU:\r\n\t\t\t\treturn 0;\r\n\t\t\tcase GameState.LOBBY:\r\n\t\t\t\tendGain = 1;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase GameState.TASKS:\r\n\t\t\t\tendGain = 1;\r\n\r\n\t\t\t\tif (lobbySettings.meetingGhostOnly) {\r\n\t\t\t\t\tendGain = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif (!me.isDead && lobbySettings.commsSabotage && state.comsSabotaged && !me.isImpostor) {\r\n\t\t\t\t\tendGain = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Mute other players which are in a vent\r\n\t\t\t\tif (\r\n\t\t\t\t\tother.inVent &&\r\n\t\t\t\t\t!(lobbySettings.hearImpostorsInVents || (lobbySettings.impostersHearImpostersInvent && me.inVent))\r\n\t\t\t\t) {\r\n\t\t\t\t\tendGain = 0;\r\n\t\t\t\t}\r\n\t\t\t\tif (\r\n\t\t\t\t\tlobbySettings.wallsBlockAudio &&\r\n\t\t\t\t\t!me.isDead &&\r\n\t\t\t\t\tposeCollide({ x: me.x, y: me.y }, { x: other.x, y: other.y }, gameState.map, gameState.closedDoors)\r\n\t\t\t\t) {\r\n\t\t\t\t\tcollided = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (\r\n\t\t\t\t\tme.isImpostor &&\r\n\t\t\t\t\tother.isImpostor &&\r\n\t\t\t\t\tlobbySettings.impostorRadioEnabled &&\r\n\t\t\t\t\tother.clientId === impostorRadioClientId.current\r\n\t\t\t\t) {\r\n\t\t\t\t\tskipDistanceCheck = true;\r\n\t\t\t\t\tmuffle.type = 'highpass';\r\n\t\t\t\t\tmuffle.frequency.value = 1000;\r\n\t\t\t\t\tmuffle.Q.value = 10;\r\n\t\t\t\t\tmuffleEnabled = true;\r\n\t\t\t\t\tif (!audio.muffleConnected) {\r\n\t\t\t\t\t\taudio.muffleConnected = true;\r\n\t\t\t\t\t\tapplyEffect(gain, muffle, destination, other);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (!me.isDead && other.isDead && me.isImpostor && lobbySettings.haunting) {\r\n\t\t\t\t\tif (!audio.reverbConnected) {\r\n\t\t\t\t\t\taudio.reverbConnected = true;\r\n\t\t\t\t\t\tapplyEffect(gain, reverb, destination, other);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcollided = false;\r\n\t\t\t\t\tendGain = 0.1;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (other.isDead && !me.isDead) {\r\n\t\t\t\t\t\tendGain = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase GameState.DISCUSSION:\r\n\t\t\t\tpanPos = [0, 0];\r\n\t\t\t\tendGain = 1;\r\n\t\t\t\tif (!me.isDead && other.isDead) {\r\n\t\t\t\t\tendGain = 0;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase GameState.UNKNOWN:\r\n\t\t\tdefault:\r\n\t\t\t\tendGain = 0;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (useLightSource && state.lightRadiusChanged) {\r\n\t\t\tpan.maxDistance = maxDistanceRef.current;\r\n\t\t}\r\n\r\n\t\tif (!other.isDead || state.gameState !== GameState.TASKS || !me.isImpostor || me.isDead) {\r\n\t\t\tif (audio.reverbConnected && reverb) {\r\n\t\t\t\taudio.reverbConnected = false;\r\n\t\t\t\trestoreEffect(gain, reverb, destination, other);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (lobbySettings.deadOnly) {\r\n\t\t\tpanPos = [0, 0];\r\n\t\t\tif (!me.isDead || !other.isDead) {\r\n\t\t\t\tendGain = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet isOnCamera = state.currentCamera !== CameraLocation.NONE;\r\n\t\tif (!skipDistanceCheck && Math.sqrt(panPos[0] * panPos[0] + panPos[1] * panPos[1]) > maxdistance) {\r\n\t\t\tif (lobbySettings.hearThroughCameras && state.gameState === GameState.TASKS) {\r\n\t\t\t\tif (state.currentCamera !== CameraLocation.NONE && state.currentCamera !== CameraLocation.Skeld) {\r\n\t\t\t\t\tconst camerapos = AmongUsMaps[state.map].cameras[state.currentCamera];\r\n\t\t\t\t\tpanPos = [other.x - camerapos.x, other.y - camerapos.y];\r\n\t\t\t\t\tconsole.log('camerapos: ', camerapos);\r\n\t\t\t\t} else if (state.currentCamera === CameraLocation.Skeld) {\r\n\t\t\t\t\tlet distance = 999;\r\n\t\t\t\t\tlet camerapos = { x: 999, y: 999 };\r\n\t\t\t\t\tfor (const camera of Object.values(AmongUsMaps[state.map].cameras)) {\r\n\t\t\t\t\t\tconst cameraDist = Math.sqrt(Math.pow(other.x - camera.x, 2) + Math.pow(other.y - camera.y, 2));\r\n\t\t\t\t\t\tif (distance > cameraDist) {\r\n\t\t\t\t\t\t\tdistance = cameraDist;\r\n\t\t\t\t\t\t\tcamerapos = camera;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (distance != 999) {\r\n\t\t\t\t\t\tpanPos = [other.x - camerapos.x, other.y - camerapos.y];\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (Math.sqrt(panPos[0] * panPos[0] + panPos[1] * panPos[1]) > maxdistance) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (collided && !skipDistanceCheck) {\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t\tisOnCamera = false;\r\n\t\t}\r\n\r\n\t\t// Muffling in vents\r\n\t\tif (\r\n\t\t\t((me.inVent && !me.isDead) || (other.inVent && !other.isDead) || isOnCamera) &&\r\n\t\t\tstate.gameState === GameState.TASKS\r\n\t\t) {\r\n\t\t\tif (!audio.muffleConnected) {\r\n\t\t\t\taudio.muffleConnected = true;\r\n\t\t\t\tapplyEffect(gain, muffle, destination, other);\r\n\t\t\t}\r\n\t\t\tmaxdistance = isOnCamera ? 3 : 0.8;\r\n\t\t\tmuffle.frequency.value = isOnCamera ? 2300 : 2000;\r\n\t\t\tmuffle.Q.value = isOnCamera ? -15 : 20;\r\n\t\t\tif (endGain === 1) endGain = isOnCamera ? 0.8 : 0.5; // Too loud at 1\r\n\t\t} else {\r\n\t\t\tif (audio.muffleConnected && !muffleEnabled) {\r\n\t\t\t\taudio.muffleConnected = false;\r\n\t\t\t\trestoreEffect(gain, muffle, destination, other);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!settings.enableSpatialAudio || skipDistanceCheck) {\r\n\t\t\tpanPos = [0, 0];\r\n\t\t}\r\n\r\n\t\tpan.positionX.setValueAtTime(panPos[0], audioContext.currentTime);\r\n\t\tpan.positionY.setValueAtTime(panPos[1], audioContext.currentTime);\r\n\t\tpan.positionZ.setValueAtTime(-0.5, audioContext.currentTime);\r\n\t\treturn endGain;\r\n\t}\r\n\r\n\tfunction notifyMobilePlayers() {\r\n\t\tif (\r\n\t\t\tsettingsRef.current.mobileHost &&\r\n\t\t\thostRef.current.gamestate !== GameState.MENU &&\r\n\t\t\thostRef.current.gamestate !== GameState.UNKNOWN\r\n\t\t) {\r\n\t\t\tconnectionStuff.current.socket?.emit('signal', {\r\n\t\t\t\tto: hostRef.current.code + '_mobile',\r\n\t\t\t\tdata: { mobileHostInfo: { isHostingMobile: true, isGameHost: hostRef.current.isHost } },\r\n\t\t\t});\r\n\t\t}\r\n\t\tsetTimeout(() => notifyMobilePlayers(), 5000);\r\n\t}\r\n\r\n\tfunction disconnectAudioHtmlElement(element: HTMLAudioElement) {\r\n\t\tconsole.log('disableing element?', element);\r\n\t\telement.pause();\r\n\t\tif (element.srcObject) {\r\n\t\t\tconst mediaStream = element.srcObject as MediaStream;\r\n\t\t\tmediaStream.getTracks().forEach((track) => track.stop());\r\n\t\t}\r\n\t\telement.removeAttribute('srcObject');\r\n\t\telement.removeAttribute('src');\r\n\t\telement.srcObject = null;\r\n\t\telement.load();\r\n\t\telement.remove();\r\n\t}\r\n\tfunction disconnectAudioElement(peer: string) {\r\n\t\tif (audioElements.current[peer]) {\r\n\t\t\tconsole.log('removing element..');\r\n\t\t\tdisconnectAudioHtmlElement(audioElements.current[peer].audioElement);\r\n\t\t\tdisconnectAudioHtmlElement(audioElements.current[peer].dummyAudioElement);\r\n\t\t\taudioElements.current[peer].pan.disconnect();\r\n\t\t\taudioElements.current[peer].gain.disconnect();\r\n\t\t\t// if (audioElements.current[peer].reverbGain != null) audioElements.current[peer].reverbGain?.disconnect();\r\n\t\t\tif (audioElements.current[peer].reverb != null) audioElements.current[peer].reverb?.disconnect();\r\n\t\t\tdelete audioElements.current[peer];\r\n\t\t}\r\n\t}\r\n\r\n\tfunction disconnectPeer(peer: string) {\r\n\t\tconsole.log('Disconnect peer: ', peer);\r\n\t\tconst connection = peerConnections[peer];\r\n\t\tif (!connection) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconnection.destroy();\r\n\t\tsetPeerConnections((connections) => {\r\n\t\t\tdelete connections[peer];\r\n\t\t\treturn connections;\r\n\t\t});\r\n\t\tdisconnectAudioElement(peer);\r\n\t}\r\n\t// Handle pushToTalk, if set\r\n\tuseEffect(() => {\r\n\t\tif (!connectionStuff.current.instream) return;\r\n\t\tconnectionStuff.current.instream.getAudioTracks()[0].enabled =\r\n\t\t\tsettings.pushToTalkMode !== pushToTalkOptions.PUSH_TO_TALK;\r\n\t\tconnectionStuff.current.pushToTalkMode = settings.pushToTalkMode;\r\n\t}, [settings.pushToTalkMode]);\r\n\r\n\t// Emit lobby settings to connected peers\r\n\tuseEffect(() => {\r\n\t\tif (hostRef.current.isHost !== true) return;\r\n\t\tObject.values(peerConnections).forEach((peer) => {\r\n\t\t\ttry {\r\n\t\t\t\tconsole.log('sendxx > ', JSON.stringify(settings.localLobbySettings));\r\n\t\t\t\tpeer.send(JSON.stringify(settings.localLobbySettings));\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.warn('failed to update lobby settings: ', e);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tsetLobbySettings({\r\n\t\t\ttype: 'set',\r\n\t\t\taction: settings.localLobbySettings,\r\n\t\t});\r\n\t}, [settings.localLobbySettings, hostRef.current.isHost]);\r\n\r\n\tuseEffect(() => {\r\n\t\tfor (const peer in audioElements.current) {\r\n\t\t\taudioElements.current[peer].pan.maxDistance = maxDistanceRef.current;\r\n\t\t}\r\n\t}, [lobbySettings.maxDistance, lobbySettings.visionHearing]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (\r\n\t\t\t!gameState ||\r\n\t\t\t!gameState.players ||\r\n\t\t\t!connectionStuff.current.socket ||\r\n\t\t\t(!hostRef.current.mobileRunning && !settings.obsOverlay)\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (hostRef.current.mobileRunning) {\r\n\t\t\tconnectionStuff.current.socket?.emit('signal', {\r\n\t\t\t\tto: gameState.lobbyCode + '_mobile',\r\n\t\t\t\tdata: { gameState, lobbySettings },\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\tsettings.obsOverlay &&\r\n\t\t\tsettings.obsSecret &&\r\n\t\t\tsettings.obsSecret.length === 9 &&\r\n\t\t\t((gameState.gameState !== GameState.UNKNOWN && gameState.gameState !== GameState.MENU) ||\r\n\t\t\t\tgameState.oldGameState !== gameState.gameState)\r\n\t\t) {\r\n\t\t\tconnectionStuff.current.overlaySocket = connectionStuff.current.socket;\r\n\r\n\t\t\tconst obsvoiceState: ObsVoiceState = {\r\n\t\t\t\toverlayState: {\r\n\t\t\t\t\tgameState: gameState.gameState,\r\n\t\t\t\t\tplayers: gameState.players.map((o) => ({\r\n\t\t\t\t\t\tid: o.id,\r\n\t\t\t\t\t\tclientId: o.clientId,\r\n\t\t\t\t\t\tinVent: o.inVent,\r\n\t\t\t\t\t\tisDead: o.isDead,\r\n\t\t\t\t\t\tname: o.name,\r\n\t\t\t\t\t\tcolorId: o.colorId,\r\n\t\t\t\t\t\thatId: o.hatId,\r\n\t\t\t\t\t\tpetId: o.petId,\r\n\t\t\t\t\t\tskinId: o.skinId,\r\n\t\t\t\t\t\tvisorId: o.visorId,\r\n\t\t\t\t\t\tdisconnected: o.disconnected,\r\n\t\t\t\t\t\tisLocal: o.isLocal,\r\n\t\t\t\t\t\tshiftedColor: o.shiftedColor,\r\n\t\t\t\t\t\tbugged: o.bugged,\r\n\t\t\t\t\t\trealColor: playerColors[o.colorId],\r\n\t\t\t\t\t\tusingRadio: o.clientId === impostorRadioClientId.current && myPlayer?.isImpostor,\r\n\t\t\t\t\t\tconnected:\r\n\t\t\t\t\t\t\t(playerSocketIdsRef.current[o.clientId] &&\r\n\t\t\t\t\t\t\t\tsocketClients[playerSocketIdsRef.current[o.clientId]]?.clientId === o.clientId) ||\r\n\t\t\t\t\t\t\tfalse,\r\n\t\t\t\t\t})),\r\n\t\t\t\t},\r\n\t\t\t\totherTalking,\r\n\t\t\t\totherDead,\r\n\t\t\t\tlocalTalking: talking,\r\n\t\t\t\tlocalIsAlive: !myPlayer?.isDead,\r\n\t\t\t\tmod: gameState.mod,\r\n\t\t\t\toldMeetingHud: gameState.oldMeetingHud,\r\n\t\t\t};\r\n\t\t\tconnectionStuff.current.overlaySocket?.emit('signal', {\r\n\t\t\t\tto: settings.obsSecret,\r\n\t\t\t\tdata: obsvoiceState,\r\n\t\t\t});\r\n\t\t}\r\n\t}, [gameState]);\r\n\r\n\t// Add settings to settingsRef\r\n\tuseEffect(() => {\r\n\t\tsettingsRef.current = settings;\r\n\t}, [settings]);\r\n\r\n\t// Add socketClients to socketClientsRef\r\n\tuseEffect(() => {\r\n\t\tsocketClientsRef.current = socketClients;\r\n\t}, [socketClients]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (\r\n\t\t\tconnectionStuff.current?.microphoneGain?.gain &&\r\n\t\t\t(settingsRef.current.microphoneGainEnabled || settingsRef.current.micSensitivityEnabled)\r\n\t\t) {\r\n\t\t\tif (!settingsRef.current.micSensitivityEnabled)\r\n\t\t\t\tconnectionStuff.current.microphoneGain.gain.value = settings.microphoneGainEnabled\r\n\t\t\t\t\t? settings.microphoneGain / 100\r\n\t\t\t\t\t: 1;\r\n\r\n\t\t\tif (connectionStuff.current?.audioListener?.options) {\r\n\t\t\t\tconnectionStuff.current.audioListener.options.minNoiseLevel = settings.micSensitivity;\r\n\t\t\t\tconnectionStuff.current.audioListener.init();\r\n\t\t\t}\r\n\t\t}\r\n\t}, [settings.microphoneGain, settings.micSensitivity]);\r\n\r\n\tconst updateLobby = () => {\r\n\t\tconsole.log(gameState);\r\n\t\tif (\r\n\t\t\t!gameState ||\r\n\t\t\t!hostRef.current.isHost ||\r\n\t\t\t!gameState.lobbyCode ||\r\n\t\t\tgameState.gameState === GameState.MENU ||\r\n\t\t\t!gameState.players\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconnectionStuff.current.socket?.emit('lobby', gameState.lobbyCode, {\r\n\t\t\tid: -1,\r\n\t\t\ttitle: lobbySettings.publicLobby_title,\r\n\t\t\thost: myPlayer?.name,\r\n\t\t\tcurrent_players: gameState.players.length,\r\n\t\t\tmax_players: gameState.maxPlayers,\r\n\t\t\tserver: gameState.currentServer,\r\n\t\t\tlanguage: lobbySettings.publicLobby_language,\r\n\t\t\tmods: gameState.mod,\r\n\t\t\tisPublic: lobbySettings.publicLobby_on,\r\n\t\t\tgameState: gameState.gameState,\r\n\t\t});\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (gameState.isHost && gameState.hostId > 0) {\r\n\t\t\tconnectionStuff.current.socket?.emit('setHost', gameState.lobbyCode, gameState.clientId);\r\n\t\t\thostRef.current.serverHostId = gameState.hostId;\r\n\t\t}\r\n\t}, [gameState.isHost]);\r\n\r\n\tuseEffect(() => {\r\n\t\tupdateLobby();\r\n\t}, [\r\n\t\tgameState.gameState,\r\n\t\tgameState?.players?.length,\r\n\t\tlobbySettings.publicLobby_title,\r\n\t\tlobbySettings.publicLobby_language,\r\n\t\tlobbySettings.publicLobby_on,\r\n\t]);\r\n\r\n\t// Add lobbySettings to lobbySettingsRef\r\n\tuseEffect(() => {\r\n\t\tlobbySettingsRef.current = lobbySettings;\r\n\t}, [lobbySettings]);\r\n\r\n\r\n\r\n\t// Set dead player data\r\n\tuseEffect(() => {\r\n\t\tif (gameState.gameState === GameState.LOBBY) {\r\n\t\t\tsetOtherDead({});\r\n\t\t} else if (gameState.gameState !== GameState.TASKS) {\r\n\t\t\tif (!gameState.players) return;\r\n\t\t\tsetOtherDead((old) => {\r\n\t\t\t\tfor (const player of gameState.players) {\r\n\t\t\t\t\told[player.clientId] = player.isDead || player.disconnected;\r\n\t\t\t\t}\r\n\t\t\t\treturn { ...old };\r\n\t\t\t});\r\n\t\t}\r\n\t}, [gameState.gameState]);\r\n\r\n\t// const [audioContext] = useState<AudioContext>(() => new AudioContext());\r\n\tconst connectionStuff = useRef<ConnectionStuff>({\r\n\t\tpushToTalkMode: settings.pushToTalkMode,\r\n\t\tdeafened: false,\r\n\t\tmuted: false,\r\n\t\timpostorRadio: null,\r\n\t\ttoggleMute: () => {\r\n\t\t\t/*empty*/\r\n\t\t},\r\n\t\ttoggleDeafen: () => {\r\n\t\t\t/*empty*/\r\n\t\t},\r\n\t});\r\n\r\n\tuseEffect(() => {\r\n\t\t(async () => {\r\n\t\t\tconst context = new AudioContext();\r\n\t\t\tconvolverBuffer.current = await context.decodeAudioData(reverbOgx);\r\n\t\t\tawait context.close();\r\n\t\t})();\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst pressing = connectionStuff.current.impostorRadio;\r\n\t\tif (\r\n\t\t\tpressing == null ||\r\n\t\t\t!myPlayer ||\r\n\t\t\t!myPlayer.isImpostor ||\r\n\t\t\tmyPlayer.isDead ||\r\n\t\t\t!(impostorRadioClientId.current === myPlayer.clientId || impostorRadioClientId.current === -1) ||\r\n\t\t\t!lobbySettingsRef.current.impostorRadioEnabled\r\n\t\t) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tradioOnAudio.play();\r\n\t\tconnectionStuff.current.impostorRadio = pressing;\r\n\t\timpostorRadioClientId.current = pressing ? myPlayer.clientId : -1;\r\n\t\tfor (const player of otherPlayers.filter((o) => o.isImpostor && !o.bugged && !o.isDead)) {\r\n\t\t\tconst peer = playerSocketIdsRef.current[player.clientId];\r\n\t\t\tconst connection = peerConnections[peer];\r\n\t\t\tif (connection !== undefined && connection.writable)\r\n\t\t\t\tconnection?.send(JSON.stringify({ impostorRadio: connectionStuff.current.impostorRadio }));\r\n\t\t}\r\n\t}, [connectionStuff.current.impostorRadio]);\r\n\r\n\tuseEffect(() => {\r\n\t\t// (async function anyNameFunction() {\r\n\t\tlet currentLobby = '';\r\n\t\t// Connect to voice relay server\r\n\t\tconnectionStuff.current.socket = io(settings.serverURL);\r\n\r\n\t\tconst { socket } = connectionStuff.current;\r\n\r\n\t\tsocket.on('error', (error: SocketError) => {\r\n\t\t\tif (error.message) {\r\n\t\t\t\tsetError(error.message);\r\n\t\t\t}\r\n\t\t\tconsole.error('socketIO error:', error);\r\n\t\t\tcurrentLobby = 'MENU';\r\n\t\t});\r\n\t\tsocket.on('connect', () => {\r\n\t\t\tsetConnected(true);\r\n\t\t\tconsole.log('CONNECTED??');\r\n\t\t});\r\n\r\n\t\tsocket.on('setHost', (hostId: number) => {\r\n\t\t\thostRef.current.serverHostId = hostId;\r\n\t\t});\r\n\r\n\t\tsocket.on('disconnect', () => {\r\n\t\t\tsetConnected(false);\r\n\t\t\tcurrentLobby = 'MENU';\r\n\t\t\tconsole.log('DISCONNECTED??');\r\n\t\t});\r\n\r\n\t\tnotifyMobilePlayers();\r\n\r\n\t\tlet iceConfig: RTCConfiguration = DEFAULT_ICE_CONFIG;\r\n\t\tsocket.on('clientPeerConfig', (clientPeerConfig: ClientPeerConfig) => {\r\n\t\t\tif (!validateClientPeerConfig(clientPeerConfig)) {\r\n\t\t\t\tlet errorsFormatted = '';\r\n\t\t\t\tif (validateClientPeerConfig.errors) {\r\n\t\t\t\t\terrorsFormatted = validateClientPeerConfig.errors\r\n\t\t\t\t\t\t.map((error) => error.dataPath + ' ' + error.message)\r\n\t\t\t\t\t\t.join('\\n');\r\n\t\t\t\t}\r\n\t\t\t\talert(\r\n\t\t\t\t\t`Server sent a malformed peer config. Default config will be used. See errors below:\\n${errorsFormatted}`\r\n\t\t\t\t);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tclientPeerConfig.forceRelayOnly &&\r\n\t\t\t\t!clientPeerConfig.iceServers.some((server) => server.urls.toString().includes('turn:'))\r\n\t\t\t) {\r\n\t\t\t\talert('Server has forced relay mode enabled but provides no relay servers. Default config will be used.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\ticeConfig = {\r\n\t\t\t\ticeTransportPolicy: clientPeerConfig.forceRelayOnly ? 'relay' : 'all',\r\n\t\t\t\ticeServers: clientPeerConfig.iceServers,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tsocket.on('VAD', (data: { activity: boolean; client: Client; socketId: string }) => {\r\n\t\t\tsetOtherVAD((old) => ({\r\n\t\t\t\t...old,\r\n\t\t\t\t[data.client.clientId]: data.activity,\r\n\t\t\t}));\r\n\t\t});\r\n\r\n\t\tsocket.on('setClient', (socketId: string, client: Client) => {\r\n\t\t\tsetSocketClients((old) => ({ ...old, [socketId]: client }));\r\n\t\t});\r\n\r\n\t\tsocket.on('setClients', (clients: SocketClientMap) => {\r\n\t\t\tsetSocketClients(clients);\r\n\t\t});\r\n\r\n\t\t// Initialize variables\r\n\t\tlet audioListener: VadNode;\r\n\r\n\t\tconst audio: MediaTrackConstraintSet = {\r\n\t\t\tdeviceId: (undefined as unknown) as string,\r\n\t\t\tautoGainControl: false,\r\n\t\t\tchannelCount: 2,\r\n\t\t\techoCancellation: settings.echoCancellation,\r\n\t\t\tlatency: 0,\r\n\t\t\tnoiseSuppression: settings.noiseSuppression,\r\n\t\t\tsampleRate: 48000,\r\n\t\t\tsampleSize: 16,\r\n\t\t};\r\n\r\n\t\t// Get microphone settings\r\n\t\tif (settingsRef.current.microphone.toLowerCase() !== 'default') audio.deviceId = settingsRef.current.microphone;\r\n\t\tnavigator.getUserMedia(\r\n\t\t\t{ video: false, audio },\r\n\t\t\tasync (inStream) => {\r\n\t\t\t\tlet stream = inStream;\r\n\t\t\t\tconst ac = new AudioContext();\r\n\t\t\t\tlet microphoneGain: GainNode | undefined;\r\n\t\t\t\tconst source = ac.createMediaStreamSource(inStream);\r\n\t\t\t\tif (settings.microphoneGainEnabled || settings.micSensitivityEnabled) {\r\n\t\t\t\t\tconsole.log('Microphone volume or sensitivityEnabled..');\r\n\t\t\t\t\tstream = (() => {\r\n\t\t\t\t\t\tmicrophoneGain = ac.createGain();\r\n\t\t\t\t\t\tconst destination = ac.createMediaStreamDestination();\r\n\t\t\t\t\t\tsource.connect(microphoneGain);\r\n\t\t\t\t\t\tmicrophoneGain.gain.value = settings.microphoneGainEnabled ? settings.microphoneGain / 100 : 1;\r\n\t\t\t\t\t\tmicrophoneGain.connect(destination);\r\n\t\t\t\t\t\tconnectionStuff.current.microphoneGain = microphoneGain;\r\n\t\t\t\t\t\treturn destination.stream;\r\n\t\t\t\t\t})();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (settingsRef.current.vadEnabled) {\r\n\t\t\t\t\taudioListener = VAD(ac, source, undefined, {\r\n\t\t\t\t\t\tonVoiceStart: () => {\r\n\t\t\t\t\t\t\tif (microphoneGain && settingsRef.current.micSensitivityEnabled) {\r\n\t\t\t\t\t\t\t\tmicrophoneGain.gain.value = settingsRef.current.microphoneGainEnabled\r\n\t\t\t\t\t\t\t\t\t? settingsRef.current.microphoneGain / 100\r\n\t\t\t\t\t\t\t\t\t: 1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsetTalking(true);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tonVoiceStop: () => {\r\n\t\t\t\t\t\t\tif (microphoneGain && settingsRef.current.micSensitivityEnabled) {\r\n\t\t\t\t\t\t\t\tmicrophoneGain.gain.value = 0;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tsetTalking(false);\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tnoiseCaptureDuration: 0,\r\n\t\t\t\t\t\tstereo: false,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\taudioListener.options.minNoiseLevel = settingsRef.current.micSensitivityEnabled\r\n\t\t\t\t\t\t? settingsRef.current.micSensitivity\r\n\t\t\t\t\t\t: 0.15;\r\n\t\t\t\t\taudioListener.options.maxNoiseLevel = 1;\r\n\r\n\t\t\t\t\taudioListener.init();\r\n\t\t\t\t\tconnectionStuff.current.audioListener = audioListener;\r\n\t\t\t\t\tconnectionStuff.current.microphoneGain = microphoneGain;\r\n\t\t\t\t}\r\n\t\t\t\tconnectionStuff.current.stream = stream;\r\n\t\t\t\tconnectionStuff.current.instream = inStream;\r\n\r\n\t\t\t\tinStream.getAudioTracks()[0].enabled = settings.pushToTalkMode !== pushToTalkOptions.PUSH_TO_TALK;\r\n\r\n\t\t\t\tconnectionStuff.current.toggleDeafen = () => {\r\n\t\t\t\t\tconnectionStuff.current.deafened = !connectionStuff.current.deafened;\r\n\t\t\t\t\tinStream.getAudioTracks()[0].enabled =\r\n\t\t\t\t\t\t!connectionStuff.current.deafened &&\r\n\t\t\t\t\t\t!connectionStuff.current.muted &&\r\n\t\t\t\t\t\tconnectionStuff.current.pushToTalkMode !== pushToTalkOptions.PUSH_TO_TALK;\r\n\t\t\t\t\tsetDeafened(connectionStuff.current.deafened);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tconnectionStuff.current.toggleMute = () => {\r\n\t\t\t\t\tconnectionStuff.current.muted = !connectionStuff.current.muted;\r\n\t\t\t\t\tif (connectionStuff.current.deafened) {\r\n\t\t\t\t\t\tconnectionStuff.current.deafened = false;\r\n\t\t\t\t\t\tconnectionStuff.current.muted = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinStream.getAudioTracks()[0].enabled =\r\n\t\t\t\t\t\t!connectionStuff.current.muted &&\r\n\t\t\t\t\t\t!connectionStuff.current.deafened &&\r\n\t\t\t\t\t\tconnectionStuff.current.pushToTalkMode !== pushToTalkOptions.PUSH_TO_TALK;\r\n\t\t\t\t\tsetMuted(connectionStuff.current.muted);\r\n\t\t\t\t\tsetDeafened(connectionStuff.current.deafened);\r\n\t\t\t\t};\r\n\r\n\t\t\t\tipcRenderer.on(IpcRendererMessages.TOGGLE_DEAFEN, connectionStuff.current.toggleDeafen);\r\n\r\n\t\t\t\tipcRenderer.on(IpcRendererMessages.IMPOSTOR_RADIO, (_: unknown, pressing: boolean) => {\r\n\t\t\t\t\tconnectionStuff.current.impostorRadio = pressing;\r\n\t\t\t\t});\r\n\r\n\t\t\t\tipcRenderer.on(IpcRendererMessages.TOGGLE_MUTE, connectionStuff.current.toggleMute);\r\n\t\t\t\tipcRenderer.on(IpcRendererMessages.PUSH_TO_TALK, (_: unknown, pressing: boolean) => {\r\n\t\t\t\t\tif (connectionStuff.current.pushToTalkMode === pushToTalkOptions.VOICE) return;\r\n\t\t\t\t\tif (!connectionStuff.current.deafened) {\r\n\t\t\t\t\t\tinStream.getAudioTracks()[0].enabled =\r\n\t\t\t\t\t\t\tconnectionStuff.current.pushToTalkMode === pushToTalkOptions.PUSH_TO_TALK ? pressing : !pressing;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\taudioElements.current = {};\r\n\r\n\t\t\t\tconst connect = (lobbyCode: string, playerId: number, clientId: number, isHost: boolean) => {\r\n\t\t\t\t\tconsole.log('connect called..', lobbyCode);\r\n\t\t\t\t\tsetOtherVAD({});\r\n\t\t\t\t\tsetOtherTalking({});\r\n\t\t\t\t\tif (lobbyCode === 'MENU') {\r\n\t\t\t\t\t\tObject.keys(peerConnections).forEach((k) => {\r\n\t\t\t\t\t\t\tdisconnectPeer(k);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tsetSocketClients({});\r\n\t\t\t\t\t\tcurrentLobby = lobbyCode;\r\n\t\t\t\t\t} else if (currentLobby !== lobbyCode) {\r\n\t\t\t\t\t\tconsole.log('Currentlobby', currentLobby, lobbyCode);\r\n\t\t\t\t\t\tsocket.emit('leave');\r\n\t\t\t\t\t\tsocket.emit('id', playerId, clientId);\r\n\t\t\t\t\t\tsocket.emit('join', lobbyCode, playerId, clientId, isHost);\r\n\t\t\t\t\t\tcurrentLobby = lobbyCode;\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\tsetConnect({ connect });\r\n\r\n\t\t\t\tfunction createPeerConnection(peer: string, initiator: boolean) {\r\n\t\t\t\t\tconsole.log('CreatePeerConnection: ', peer, initiator);\r\n\r\n\t\t\t\t\tconst connection = new Peer({\r\n\t\t\t\t\t\tstream,\r\n\t\t\t\t\t\tinitiator, // @ts-ignore-line\r\n\t\t\t\t\t\ticeRestartEnabled: true,\r\n\t\t\t\t\t\tconfig: settingsRef.current.natFix ? DEFAULT_ICE_CONFIG_TURN : iceConfig,\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tsetPeerConnections((connections) => {\r\n\t\t\t\t\t\tconnections[peer] = connection;\r\n\t\t\t\t\t\treturn connections;\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconnection.on('connect', () => {\r\n\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\tif (hostRef.current.isHost && connection.writable) {\r\n\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\tconsole.log('sending settings..');\r\n\t\t\t\t\t\t\t\t\tconnection.send(JSON.stringify(lobbySettingsRef.current));\r\n\t\t\t\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t\t\t\tconsole.warn('failed to update lobby settings: ', e);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconnection.on('stream', async (stream: MediaStream) => {\r\n\t\t\t\t\t\tconsole.log('ONSTREAM');\r\n\r\n\t\t\t\t\t\tsetAudioConnected((old) => ({ ...old, [peer]: true }));\r\n\t\t\t\t\t\tconst dummyAudio = new Audio();\r\n\t\t\t\t\t\tdummyAudio.srcObject = stream;\r\n\t\t\t\t\t\tconst context = new AudioContext();\r\n\t\t\t\t\t\tconst source = context.createMediaStreamSource(stream);\r\n\t\t\t\t\t\tconst dest = context.createMediaStreamDestination();\r\n\r\n\t\t\t\t\t\tconst gain = context.createGain();\r\n\t\t\t\t\t\tconst pan = context.createPanner();\r\n\t\t\t\t\t\tgain.gain.value = 0;\r\n\t\t\t\t\t\tpan.refDistance = 0.1;\r\n\t\t\t\t\t\tpan.panningModel = 'equalpower';\r\n\t\t\t\t\t\tpan.distanceModel = 'linear';\r\n\t\t\t\t\t\tpan.maxDistance = maxDistanceRef.current;\r\n\t\t\t\t\t\tpan.rolloffFactor = 1;\r\n\r\n\t\t\t\t\t\tconst muffle = context.createBiquadFilter();\r\n\t\t\t\t\t\tmuffle.type = 'lowpass';\r\n\r\n\t\t\t\t\t\tsource.connect(pan);\r\n\t\t\t\t\t\tpan.connect(gain);\r\n\r\n\t\t\t\t\t\tconst reverb = context.createConvolver();\r\n\t\t\t\t\t\treverb.buffer = convolverBuffer.current;\r\n\t\t\t\t\t\tconst destination: AudioNode = dest;\r\n\t\t\t\t\t\t// if (settingsRef.current.vadEnabled) {\r\n\t\t\t\t\t\t// \tVAD(context, gain, undefined, {\r\n\t\t\t\t\t\t// \t\tonVoiceStart: () => setTalking(true),\r\n\t\t\t\t\t\t// \t\tonVoiceStop: () => setTalking(false),\r\n\t\t\t\t\t\t// \t\tstereo: false,\r\n\t\t\t\t\t\t// \t});\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\tgain.connect(destination);\r\n\t\t\t\t\t\tconst audio = document.createElement('audio') as ExtendedAudioElement;\r\n\t\t\t\t\t\tdocument.body.appendChild(audio);\r\n\t\t\t\t\t\taudio.setAttribute('autoplay', '');\r\n\t\t\t\t\t\taudio.srcObject = dest.stream;\r\n\t\t\t\t\t\tif (settingsRef.current.speaker.toLowerCase() !== 'default') {\r\n\t\t\t\t\t\t\taudio.setSinkId(settingsRef.current.speaker);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (audioElements.current[peer]) {\r\n\t\t\t\t\t\t\tdisconnectAudioElement(peer);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\taudioElements.current[peer] = {\r\n\t\t\t\t\t\t\tdummyAudioElement: dummyAudio,\r\n\t\t\t\t\t\t\taudioElement: audio,\r\n\t\t\t\t\t\t\tgain,\r\n\t\t\t\t\t\t\tpan,\r\n\t\t\t\t\t\t\treverb,\r\n\t\t\t\t\t\t\tmuffle,\r\n\t\t\t\t\t\t\tmuffleConnected: false,\r\n\t\t\t\t\t\t\treverbConnected: false,\r\n\t\t\t\t\t\t\tdestination,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconnection.on('signal', (data) => {\r\n\t\t\t\t\t\tsocket.emit('signal', {\r\n\t\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\t\tto: peer,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t\tconnection.on('data', (data) => {\r\n\t\t\t\t\t\tconst parsedData = JSON.parse(data);\r\n\t\t\t\t\t\tif (parsedData.hasOwnProperty('impostorRadio')) {\r\n\t\t\t\t\t\t\tconst clientId = socketClientsRef.current[peer]?.clientId;\r\n\t\t\t\t\t\t\tif (impostorRadioClientId.current === -1 && parsedData['impostorRadio']) {\r\n\t\t\t\t\t\t\t\timpostorRadioClientId.current = clientId;\r\n\t\t\t\t\t\t\t} else if (impostorRadioClientId.current === clientId && !parsedData['impostorRadio']) {\r\n\t\t\t\t\t\t\t\timpostorRadioClientId.current = -1;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconsole.log('Recieved impostor radio request', parsedData);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (parsedData.hasOwnProperty('maxDistance')) {\r\n\t\t\t\t\t\t\tif (!hostRef.current || hostRef.current.parsedHostId !== socketClientsRef.current[peer]?.clientId) return;\r\n\r\n\t\t\t\t\t\t\tObject.keys(lobbySettings).forEach((field: string) => {\r\n\t\t\t\t\t\t\t\tif (field in parsedData) {\r\n\t\t\t\t\t\t\t\t\tsetLobbySettings({\r\n\t\t\t\t\t\t\t\t\t\ttype: 'setOne',\r\n\t\t\t\t\t\t\t\t\t\taction: [field, parsedData[field]],\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tif (field in defaultlocalLobbySettings) {\r\n\t\t\t\t\t\t\t\t\t\tsetLobbySettings({\r\n\t\t\t\t\t\t\t\t\t\t\ttype: 'setOne',\r\n\t\t\t\t\t\t\t\t\t\t\taction: [field, defaultlocalLobbySettings[field as keyof ILobbySettings]],\r\n\t\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconnection.on('close', () => {\r\n\t\t\t\t\t\tconsole.log('Disconnected from', peer, 'Initiator:', initiator);\r\n\t\t\t\t\t\tdisconnectPeer(peer);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconnection.on('error', () => {\r\n\t\t\t\t\t\tconsole.log('ONERROR');\r\n\t\t\t\t\t\t/*empty*/\r\n\t\t\t\t\t});\r\n\t\t\t\t\treturn connection;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tsocket.on('join', async (peer: string, client: Client) => {\r\n\t\t\t\t\tconst oldSocketId = playerSocketIdsRef.current[client.clientId];\r\n\t\t\t\t\tif (oldSocketId && audioElements.current[oldSocketId]) {\r\n\t\t\t\t\t\tdisconnectAudioElement(oldSocketId);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcreatePeerConnection(peer, true);\r\n\t\t\t\t\tsetSocketClients((old) => ({ ...old, [peer]: client }));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tsocket.on('signal', ({ data, from }: { data: Peer.SignalData; from: string }) => {\r\n\t\t\t\t\t//console.log('onsignal', JSON.stringify(data));\r\n\t\t\t\t\tif (data.hasOwnProperty('mobilePlayerInfo')) {\r\n\t\t\t\t\t\t// eslint-disable-line\r\n\t\t\t\t\t\tconst mobiledata = data as mobileHostInfo;\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tmobiledata.mobilePlayerInfo.code === hostRef.current.code &&\r\n\t\t\t\t\t\t\thostRef.current.gamestate !== GameState.MENU\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\thostRef.current.mobileRunning = true;\r\n\t\t\t\t\t\t\tconsole.log('setting mobileRunning to true..');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconsole.log('ONSIGNAL', data);\r\n\t\t\t\t\tlet connection: Peer.Instance;\r\n\t\t\t\t\tif (!socketClientsRef.current[from]) {\r\n\t\t\t\t\t\tconsole.warn('SIGNAL FROM UNKOWN SOCKET..');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data.hasOwnProperty('type')) {\r\n\t\t\t\t\t\t// if (data.type === 'offer' && peerConnections[from]) {\r\n\t\t\t\t\t\t// \tconsole.log(\"Got offer with already a connection\")\r\n\t\t\t\t\t\t// }\r\n\t\t\t\t\t\tif (peerConnections[from] && data.type !== 'offer') {\r\n\t\t\t\t\t\t\tconsole.log('Send to existing peer 1');\r\n\t\t\t\t\t\t\tconnection = peerConnections[from];\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.log('Send to new peer 1');\r\n\t\t\t\t\t\t\tconnection = createPeerConnection(from, false);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconnection.signal(data);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t(error) => {\r\n\t\t\t\tconsole.error(error);\r\n\t\t\t\tsetError(\"Couldn't connect to your microphone:\\n\" + error);\r\n\t\t\t\t// ipcRenderer.send(IpcMessages.SHOW_ERROR_DIALOG, {\r\n\t\t\t\t// \ttitle: 'Error',\r\n\t\t\t\t// \tcontent: 'Couldn\\'t connect to your microphone:\\n' + error\r\n\t\t\t\t// });\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\treturn () => {\r\n\t\t\thostRef.current.mobileRunning = false;\r\n\t\t\tsocket.emit('leave');\r\n\t\t\tObject.keys(peerConnections).forEach((k) => {\r\n\t\t\t\tdisconnectPeer(k);\r\n\t\t\t});\r\n\t\t\tconnectionStuff.current.socket?.close();\r\n\r\n\t\t\taudioListener?.destroy();\r\n\t\t};\r\n\t\t// })();\r\n\t}, []);\r\n\r\n\tinterface mobileHostInfo {\r\n\t\tmobilePlayerInfo: {\r\n\t\t\tcode: string;\r\n\t\t\taskingForHost: boolean;\r\n\t\t};\r\n\t}\r\n\r\n\t//data: { mobilePlayerInfo: { code: this.gamecode, askingForHost: true }\r\n\tconst myPlayer = useMemo(() => {\r\n\t\tif (!gameState || !gameState.players) {\r\n\t\t\treturn undefined;\r\n\t\t} else {\r\n\t\t\treturn gameState.players.find((p) => p.isLocal);\r\n\t\t}\r\n\t}, [gameState.players]);\r\n\r\n\tconst otherPlayers = useMemo(() => {\r\n\t\tlet otherPlayers: Player[];\r\n\t\tif (!gameState || !gameState.players || !myPlayer) return [];\r\n\t\telse otherPlayers = gameState.players.filter((p) => !p.isLocal);\r\n\t\tmaxDistanceRef.current = lobbySettings.visionHearing\r\n\t\t\t? myPlayer.isImpostor\r\n\t\t\t\t? lobbySettings.maxDistance\r\n\t\t\t\t: gameState.lightRadius + 0.5\r\n\t\t\t: lobbySettings.maxDistance;\r\n\t\tif (maxDistanceRef.current <= 0.6) {\r\n\t\t\tmaxDistanceRef.current = 1;\r\n\t\t}\r\n\t\thostRef.current = {\r\n\t\t\tmap: gameState.map,\r\n\t\t\tmobileRunning: hostRef.current.mobileRunning,\r\n\t\t\tgamestate: gameState.gameState,\r\n\t\t\tcode: gameState.lobbyCode,\r\n\t\t\thostId: gameState.hostId,\r\n\t\t\tisHost: gameState.hostId > 0 ? gameState.isHost : hostRef.current.serverHostId === gameState.clientId,\r\n\t\t\tparsedHostId: gameState.hostId > 0 ? gameState.hostId : hostRef.current.serverHostId,\r\n\t\t\tserverHostId: hostRef.current.serverHostId,\r\n\t\t};\r\n\t\tconst playerSocketIds: numberStringMap = {};\r\n\t\tfor (const k of Object.keys(socketClients)) {\r\n\t\t\tplayerSocketIds[socketClients[k].clientId] = k;\r\n\t\t}\r\n\t\tplayerSocketIdsRef.current = playerSocketIds;\r\n\t\tconst handledPeerIds: string[] = [];\r\n\t\tlet foundRadioUser = false;\r\n\t\tconst tempTalking = { ...otherTalking };\r\n\t\tlet talkingUpdate = false;\r\n\t\tfor (const player of otherPlayers) {\r\n\t\t\tconst peerId = playerSocketIds[player.clientId];\r\n\t\t\tconst audio = player.clientId === myPlayer.clientId ? undefined : audioElements.current[peerId];\r\n\t\t\tif (\r\n\t\t\t\tplayer.clientId === impostorRadioClientId.current &&\r\n\t\t\t\tplayer.isImpostor &&\r\n\t\t\t\t!player.isDead &&\r\n\t\t\t\t!player.disconnected &&\r\n\t\t\t\t!player.bugged\r\n\t\t\t) {\r\n\t\t\t\tfoundRadioUser = true;\r\n\t\t\t}\r\n\t\t\tif (audio) {\r\n\t\t\t\thandledPeerIds.push(peerId);\r\n\t\t\t\tlet gain = calculateVoiceAudio(gameState, settingsRef.current, myPlayer, player, audio);\r\n\t\t\t\tif (connectionStuff.current.deafened || playerConfigs[player.nameHash]?.isMuted) {\r\n\t\t\t\t\tgain = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (gain > 0) {\r\n\t\t\t\t\tconst playerVolume = playerConfigs[player.nameHash]?.volume;\r\n\t\t\t\t\tgain = playerVolume === undefined ? gain : gain * playerVolume;\r\n\r\n\t\t\t\t\tif (myPlayer.isDead && !player.isDead) {\r\n\t\t\t\t\t\tgain = gain * (settings.ghostVolume / 100);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgain = gain * (settings.masterVolume / 100);\r\n\t\t\t\t}\r\n\t\t\t\taudio.gain.gain.value = gain;\r\n\t\t\t\ttempTalking[player.clientId] = otherVAD[player.clientId] && gain > 0;\r\n\t\t\t\tif (tempTalking[player.clientId] != otherTalking[player.clientId]) {\r\n\t\t\t\t\ttalkingUpdate = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (talkingUpdate) {\r\n\t\t\tsetOtherTalking(tempTalking);\r\n\t\t}\r\n\r\n\t\tif (\r\n\t\t\t((!foundRadioUser && impostorRadioClientId.current !== myPlayer.clientId) || !myPlayer.isImpostor) &&\r\n\t\t\timpostorRadioClientId.current !== -1\r\n\t\t) {\r\n\t\t\timpostorRadioClientId.current = -1;\r\n\t\t}\r\n\t\tfor (const peerId in Object.keys(audioElements.current).filter((e) => !handledPeerIds.includes(e))) {\r\n\t\t\tconst audio = audioElements.current[peerId];\r\n\t\t\tif (audio && audio.gain) {\r\n\t\t\t\taudio.gain.gain.value = 0;\r\n\t\t\t}\r\n\t\t\t// maybe disconnect later\r\n\t\t}\r\n\r\n\t\treturn otherPlayers;\r\n\t}, [gameState]);\r\n\r\n\t// Connect to P2P negotiator, when lobby and connect code change\r\n\tuseEffect(() => {\r\n\t\tif (connect?.connect) {\r\n\t\t\tconnect.connect(gameState?.lobbyCode ?? 'MENU', myPlayer?.id ?? 0, gameState.clientId, gameState.isHost);\r\n\t\t\tupdateLobby();\r\n\t\t}\r\n\t}, [connect?.connect, gameState?.lobbyCode, connected]);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (myPlayer?.shiftedColor != -1) {\r\n\t\t\tconnectionStuff.current.socket?.emit('VAD', false);\r\n\t\t\tsetTalking(false)\r\n\t\t}\r\n\t}, [myPlayer?.shiftedColor])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (myPlayer?.shiftedColor == -1 || !talking)\r\n\t\t\tconnectionStuff.current.socket?.emit('VAD', talking);\r\n\t}, [talking])\r\n\r\n\t// Connect to P2P negotiator, when game mode change\r\n\tuseEffect(() => {\r\n\t\tif (\r\n\t\t\tconnect?.connect &&\r\n\t\t\tgameState.lobbyCode &&\r\n\t\t\tmyPlayer?.clientId !== undefined &&\r\n\t\t\tgameState.gameState === GameState.LOBBY &&\r\n\t\t\t(gameState.oldGameState === GameState.DISCUSSION || gameState.oldGameState === GameState.TASKS)\r\n\t\t) {\r\n\t\t\thostRef.current.mobileRunning = false;\r\n\t\t\tconnect.connect(gameState.lobbyCode, myPlayer.clientId, gameState.clientId, gameState.isHost);\r\n\t\t} else if (\r\n\t\t\tgameState.oldGameState !== GameState.UNKNOWN &&\r\n\t\t\tgameState.oldGameState !== GameState.MENU &&\r\n\t\t\tgameState.gameState === GameState.MENU\r\n\t\t) {\r\n\t\t\tconsole.log('DISCONNECT TO MENU!');\r\n\t\t\t// On change from a game to menu, exit from the current game properly\r\n\t\t\thostRef.current.mobileRunning = false; // On change from a game to menu, exit from the current game properly\r\n\t\t\tconnectionStuff.current.socket?.emit('leave');\r\n\t\t\tObject.keys(peerConnections).forEach((k) => {\r\n\t\t\t\tdisconnectPeer(k);\r\n\t\t\t});\r\n\t\t\tsetOtherDead({});\r\n\t\t}\r\n\t}, [gameState.gameState]);\r\n\r\n\t// Emit player id to socket\r\n\tuseEffect(() => {\r\n\t\tif (connectionStuff.current.socket && myPlayer && myPlayer.clientId !== undefined) {\r\n\t\t\tconnectionStuff.current.socket.emit('id', myPlayer.id, gameState.clientId);\r\n\t\t}\r\n\t}, [myPlayer?.id, myPlayer?.clientId]);\r\n\r\n\t// Pass voice state to overlay\r\n\tuseEffect(() => {\r\n\t\tif (!settings.enableOverlay) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tipcRenderer.send(IpcMessages.SEND_TO_OVERLAY, IpcOverlayMessages.NOTIFY_VOICE_STATE_CHANGED, {\r\n\t\t\totherTalking,\r\n\t\t\tplayerSocketIds: playerSocketIdsRef.current,\r\n\t\t\totherDead,\r\n\t\t\tsocketClients,\r\n\t\t\taudioConnected,\r\n\t\t\tlocalTalking: talking,\r\n\t\t\tlocalIsAlive: !myPlayer?.isDead,\r\n\t\t\timpostorRadioClientId: !myPlayer?.isImpostor ? -1 : impostorRadioClientId.current,\r\n\t\t\tmuted: mutedState,\r\n\t\t\tdeafened: deafenedState,\r\n\t\t\tmod: gameState.mod,\r\n\t\t} as VoiceState);\r\n\t}, [\r\n\t\totherTalking,\r\n\t\totherDead,\r\n\t\tsocketClients,\r\n\t\taudioConnected,\r\n\t\ttalking,\r\n\t\tmutedState,\r\n\t\tdeafenedState,\r\n\t\timpostorRadioClientId.current,\r\n\t]);\r\n\r\n\treturn (\r\n\t\t<div className={classes.root}>\r\n\t\t\t{(error || initialError) && (\r\n\t\t\t\t<div className={classes.error}>\r\n\t\t\t\t\t<Typography align=\"center\" variant=\"h6\" color=\"error\">\r\n\t\t\t\t\t\tERROR\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<Typography align=\"center\" style={{ whiteSpace: 'pre-wrap' }}>\r\n\t\t\t\t\t\t{error}\r\n\t\t\t\t\t\t{initialError}\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<SupportLink />\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t{(!error && !initialError) && (<>\r\n\r\n\t\t\t\t<div className={classes.top}>\r\n\t\t\t\t\t{myPlayer && gameState.lobbyCode !== 'MENU' && (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<div className={classes.avatarWrapper}>\r\n\t\t\t\t\t\t\t\t<Avatar\r\n\t\t\t\t\t\t\t\t\tdeafened={deafenedState}\r\n\t\t\t\t\t\t\t\t\tmuted={mutedState}\r\n\t\t\t\t\t\t\t\t\tplayer={myPlayer}\r\n\t\t\t\t\t\t\t\t\tborderColor={myPlayer?.shiftedColor == -1 ? '#2ecc71' : 'gray'}\r\n\t\t\t\t\t\t\t\t\tconnectionState={connected ? 'connected' : 'disconnected'}\r\n\t\t\t\t\t\t\t\t\tisUsingRadio={myPlayer?.isImpostor && impostorRadioClientId.current === myPlayer.clientId}\r\n\t\t\t\t\t\t\t\t\ttalking={talking}\r\n\t\t\t\t\t\t\t\t\tisAlive={!myPlayer.isDead}\r\n\t\t\t\t\t\t\t\t\tsize={100}\r\n\t\t\t\t\t\t\t\t\tmod={gameState.mod}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t<div className={classes.right}>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<div className={classes.left}>\r\n\t\t\t\t\t\t\t\t{myPlayer && gameState?.gameState !== GameState.MENU && (\r\n\t\t\t\t\t\t\t\t\t<span className={classes.username}>{myPlayer.name}</span>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t<span\r\n\t\t\t\t\t\t\t\t\tclassName={classes.code}\r\n\t\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\t\tbackground: gameState.lobbyCode === 'MENU' ? 'transparent' : '#3e4346',\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t{displayedLobbyCode === 'MENU' ? t('game.menu') : displayedLobbyCode}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t{gameState.lobbyCode !== 'MENU' && (\r\n\t\t\t\t\t\t\t\t<div className={classes.muteButtons}>\r\n\t\t\t\t\t\t\t\t\t<IconButton onClick={connectionStuff.current.toggleMute} size=\"small\">\r\n\t\t\t\t\t\t\t\t\t\t{mutedState || deafenedState ? <MicOff /> : <Mic />}\r\n\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t\t<IconButton onClick={connectionStuff.current.toggleDeafen} size=\"small\">\r\n\t\t\t\t\t\t\t\t\t\t{deafenedState ? <VolumeOff /> : <VolumeUp />}\r\n\t\t\t\t\t\t\t\t\t</IconButton>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t{lobbySettings.deadOnly && (\r\n\t\t\t\t\t<div className={classes.top}>\r\n\t\t\t\t\t\t<small style={{ padding: 0 }}>{t('settings.lobbysettings.ghost_only_warning2')}</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t{lobbySettings.meetingGhostOnly && (\r\n\t\t\t\t\t<div className={classes.top}>\r\n\t\t\t\t\t\t<small style={{ padding: 0 }}>{t('settings.lobbysettings.meetings_only_warning2')}</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t{gameState.lobbyCode && <Divider />}\r\n\t\t\t\t{displayedLobbyCode === 'MENU' && (\r\n\t\t\t\t\t<div className={classes.top}>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\tstyle={{ margin: '10px' }}\r\n\t\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\t\tipcRenderer.send(IpcHandlerMessages.OPEN_LOBBYBROWSER);\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tcolor=\"primary\"\r\n\t\t\t\t\t\t\tvariant=\"outlined\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t{t('buttons.public_lobby')}\r\n\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t\t{myPlayer && gameState.lobbyCode !== 'MENU' && (\r\n\t\t\t\t\t<Grid\r\n\t\t\t\t\t\tcontainer\r\n\t\t\t\t\t\tspacing={1}\r\n\t\t\t\t\t\tclassName={classes.otherplayers}\r\n\t\t\t\t\t\talignItems=\"flex-start\"\r\n\t\t\t\t\t\talignContent=\"flex-start\"\r\n\t\t\t\t\t\tjustify=\"flex-start\"\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{otherPlayers.map((player) => {\r\n\t\t\t\t\t\t\tconst peer = playerSocketIdsRef.current[player.clientId];\r\n\t\t\t\t\t\t\tconst connected = socketClients[peer]?.clientId === player.clientId || false;\r\n\t\t\t\t\t\t\tconst audio = audioConnected[peer];\r\n\r\n\t\t\t\t\t\t\tif (!playerConfigs[player.nameHash]) {\r\n\t\t\t\t\t\t\t\tplayerConfigs[player.nameHash] = { volume: 1, isMuted: false };\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tconst socketConfig = playerConfigs[player.nameHash];\r\n\r\n\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t<Grid item key={player.id} xs={getPlayersPerRow(otherPlayers.length)}>\r\n\t\t\t\t\t\t\t\t\t<Avatar\r\n\t\t\t\t\t\t\t\t\t\tconnectionState={!connected ? 'disconnected' : audio ? 'connected' : 'novoice'}\r\n\t\t\t\t\t\t\t\t\t\tplayer={player}\r\n\t\t\t\t\t\t\t\t\t\ttalking={!player.inVent && otherTalking[player.clientId]}\r\n\t\t\t\t\t\t\t\t\t\tborderColor=\"#2ecc71\"\r\n\t\t\t\t\t\t\t\t\t\tisAlive={!otherDead[player.clientId]}\r\n\t\t\t\t\t\t\t\t\t\tisUsingRadio={\r\n\t\t\t\t\t\t\t\t\t\t\tmyPlayer?.isImpostor &&\r\n\t\t\t\t\t\t\t\t\t\t\t!(player.disconnected || player.bugged) &&\r\n\t\t\t\t\t\t\t\t\t\t\timpostorRadioClientId.current === player.clientId\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\tsize={50}\r\n\t\t\t\t\t\t\t\t\t\tsocketConfig={socketConfig}\r\n\t\t\t\t\t\t\t\t\t\tonConfigChange={() => {\r\n\t\t\t\t\t\t\t\t\t\t\tstore.set(`playerConfigMap.${player.nameHash}`, playerConfigs[player.nameHash]);\r\n\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\tmod={gameState.mod}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t</Grid>\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</Grid>\r\n\t\t\t\t)}\r\n\t\t\t</>)}\r\n\t\t\t{otherPlayers.length <= 6 && <Footer />}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\ntype ValidPlayersPerRow = 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12;\r\nfunction getPlayersPerRow(playerCount: number): ValidPlayersPerRow {\r\n\tif (playerCount <= 9) return (12 / 3) as ValidPlayersPerRow;\r\n\telse return Math.min(12, Math.floor(12 / Math.ceil(Math.sqrt(playerCount)))) as ValidPlayersPerRow;\r\n}\r\n\r\nexport default Voice;\r\n"]}