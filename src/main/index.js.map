{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":"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","sourcesContent":["'use strict'; // eslint-disable-line\r\n\r\nimport { autoUpdater } from 'electron-updater';\r\nimport { app, BrowserWindow, ipcMain, session } from 'electron';\r\nimport windowStateKeeper from 'electron-window-state';\r\nimport { platform } from 'os';\r\nimport { join as joinPath } from 'path';\r\nimport { format as formatUrl } from 'url';\r\nimport './hook';\r\nimport { overlayWindow } from 'electron-overlay-window';\r\nimport { initializeIpcHandlers, initializeIpcListeners } from './ipc-handlers';\r\nimport { IpcRendererMessages /*AutoUpdaterState*/, IpcHandlerMessages } from '../common/ipc-messages';\r\nimport { ProgressInfo, UpdateInfo } from 'builder-util-runtime';\r\nimport { protocol } from 'electron';\r\nimport Store from 'electron-store';\r\nimport { ISettings } from '../common/ISettings';\r\nimport installExtension, { REACT_DEVELOPER_TOOLS } from 'electron-devtools-installer';\r\nimport { gameReader } from './hook';\r\nimport { GenerateHat } from './avatarGenerator';\r\nconst args = require('minimist')(process.argv); // eslint-disable-line\r\nconst isDevelopment = process.env.NODE_ENV !== 'production';\r\nconst devTools = (isDevelopment || args.dev === 1) && true;\r\n\r\ndeclare global {\r\n\tnamespace NodeJS {\r\n\t\t// eslint-disable-line\r\n\t\tinterface Global {\r\n\t\t\tmainWindow: BrowserWindow | null;\r\n\t\t\toverlay: BrowserWindow | null;\r\n\t\t\tlobbyBrowser: BrowserWindow | null;\r\n\t\t}\r\n\t}\r\n}\r\n// global reference to mainWindow (necessary to prevent window from being garbage collected)\r\nglobal.mainWindow = null;\r\nglobal.overlay = null;\r\nconst store = new Store<ISettings>();\r\napp.commandLine.appendSwitch('disable-pinch');\r\n// app.disableHardwareAcceleration();\r\nif (platform() === 'linux' || !store.get('hardware_acceleration', true)) {\r\n\tapp.disableHardwareAcceleration();\r\n}\r\n\r\nfunction createMainWindow() {\r\n\tconst mainWindowState = windowStateKeeper({});\r\n\r\n\tconst window = new BrowserWindow({\r\n\t\ttitle: 'BetterCrewLink',\r\n\t\twidth: 250,\r\n\t\theight: 350,\r\n\t\tmaxWidth: 250,\r\n\t\tminWidth: 250,\r\n\t\tmaxHeight: 350,\r\n\t\tminHeight: 350,\r\n\t\tx: mainWindowState.x,\r\n\t\ty: mainWindowState.y,\r\n\t\tresizable: false,\r\n\t\tframe: false,\r\n\t\tfullscreenable: false,\r\n\t\tmaximizable: false,\r\n\t\twebPreferences: {\r\n\t\t\tnodeIntegration: true,\r\n\t\t\tcontextIsolation: false\r\n\t\t},\r\n\t});\r\n\tmainWindowState.manage(window);\r\n\r\n\tif (devTools) {\r\n\t\t//Force devtools into detached mode otherwise they are unusable\r\n\t\twindow.on('ready-to-show', () => {\r\n\t\t\twindow.webContents.openDevTools({\r\n\t\t\t\tmode: 'detach',\r\n\t\t\t});\r\n\t\t})\r\n\t}\r\n\r\n\tlet crewlinkVersion: string;\r\n\tif (isDevelopment) {\r\n\t\tcrewlinkVersion = '0.0.0';\r\n\t\t//window.loadURL(\"http://google.nl\")\r\n\r\n\t\twindow.loadURL(`http://localhost:${process.env.ELECTRON_WEBPACK_WDS_PORT}?version=DEV&view=app`);\r\n\t} else {\r\n\t\tcrewlinkVersion = autoUpdater.currentVersion.version;\r\n\t\twindow.loadURL(\r\n\t\t\tformatUrl({\r\n\t\t\t\tpathname: joinPath(__dirname, 'index.html'),\r\n\t\t\t\tprotocol: 'file',\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tversion: autoUpdater.currentVersion.version,\r\n\t\t\t\t\tview: 'app',\r\n\t\t\t\t},\r\n\t\t\t\tslashes: true,\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\t//window.webContents.userAgent = `CrewLink/${crewlinkVersion} (${process.platform})`;\r\n\twindow.webContents.userAgent = `CrewLink/2.0.1 (win32)`;\r\n\r\n\twindow.on('closed', () => {\r\n\t\ttry {\r\n\t\t\tconst mainWindow = global.mainWindow;\r\n\t\t\tconst overlay = global.overlay;\r\n\t\t\tglobal.mainWindow = null;\r\n\t\t\tglobal.overlay = null;\r\n\t\t\toverlay?.close();\r\n\t\t\tmainWindow?.destroy();\r\n\t\t\toverlay?.destroy();\r\n\t\t} catch {\r\n\t\t\t/* empty */\r\n\t\t}\r\n\t});\r\n\r\n\twindow.webContents.on('devtools-opened', () => {\r\n\t\twindow.focus();\r\n\t\tsetImmediate(() => {\r\n\t\t\twindow.focus();\r\n\t\t});\r\n\t});\r\n\tconsole.log('Opened app version: ', crewlinkVersion);\r\n\treturn window;\r\n}\r\n\r\nfunction createLobbyBrowser() {\r\n\tconst window = new BrowserWindow({\r\n\t\ttitle: 'BetterCrewLink Browser',\r\n\t\twidth: 900,\r\n\t\theight: 500,\r\n\t\tminWidth: 250,\r\n\t\tminHeight: 350,\r\n\t\tresizable: true,\r\n\t\tframe: false,\r\n\t\tfullscreenable: false,\r\n\t\tclosable: true,\r\n\t\tmaximizable: false,\r\n\t\twebPreferences: {\r\n\t\t\tnodeIntegration: true,\r\n\t\t\tcontextIsolation: false,\r\n\t\t},\r\n\t});\r\n\r\n\twindow.on('closed', () => {\r\n\t\tglobal.lobbyBrowser = null;\r\n\t});\r\n\t// if (devTools) {\r\n\t// \t// Force devtools into detached mode otherwise they are unusable\r\n\t// \twindow.webContents.openDevTools({\r\n\t// \t\tmode: 'detach',\r\n\t// \t});\r\n\t// }\r\n\tlet crewlinkVersion: string;\r\n\tif (isDevelopment) {\r\n\t\tcrewlinkVersion = '0.0.0';\r\n\t\twindow.loadURL(`http://localhost:${process.env.ELECTRON_WEBPACK_WDS_PORT}?version=DEV&view=lobbies`);\r\n\t} else {\r\n\t\tcrewlinkVersion = autoUpdater.currentVersion.version;\r\n\t\twindow.loadURL(\r\n\t\t\tformatUrl({\r\n\t\t\t\tpathname: joinPath(__dirname, 'index.html'),\r\n\t\t\t\tprotocol: 'file',\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tversion: autoUpdater.currentVersion.version,\r\n\t\t\t\t\tview: 'lobbies',\r\n\t\t\t\t},\r\n\t\t\t\tslashes: true,\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\twindow.webContents.userAgent = `CrewLink/2.0.1 (win32)`;\r\n\tconsole.log('Opened app version: ', crewlinkVersion);\r\n\treturn window;\r\n}\r\n\r\nfunction createOverlay() {\r\n\tconst overlay = new BrowserWindow({\r\n\t\ttitle: 'BetterCrewLink Overlay',\r\n\t\twidth: 400,\r\n\t\theight: 300,\r\n\t\twebPreferences: {\r\n\t\t\tnodeIntegration: true,\r\n\t\t\tcontextIsolation: false,\r\n\t\t},\r\n\t\tfullscreenable: true,\r\n\t\tskipTaskbar: true,\r\n\t\tframe: false,\r\n\t\tshow: false,\r\n\t\ttransparent: true,\r\n\t\tresizable: true,\r\n\t\tfocusable: false,\r\n\r\n\t\t//\t...overlayWindow.WINDOW_OPTS,\r\n\t});\r\n\r\n\tif (devTools) {\r\n\t\toverlay.webContents.openDevTools({\r\n\t\t\tmode: 'detach',\r\n\t\t});\r\n\t}\r\n\r\n\tif (isDevelopment) {\r\n\t\toverlay.loadURL(\r\n\t\t\t`http://localhost:${process.env.ELECTRON_WEBPACK_WDS_PORT}?version=${autoUpdater.currentVersion.version}&view=overlay`\r\n\t\t);\r\n\t} else {\r\n\t\toverlay.loadURL(\r\n\t\t\tformatUrl({\r\n\t\t\t\tpathname: joinPath(__dirname, 'index.html'),\r\n\t\t\t\tprotocol: 'file',\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tversion: autoUpdater.currentVersion.version,\r\n\t\t\t\t\tview: 'overlay',\r\n\t\t\t\t},\r\n\t\t\t\tslashes: true,\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\toverlay.setIgnoreMouseEvents(true);\r\n\toverlayWindow.attachTo(overlay, 'Among Us');\r\n\r\n\treturn overlay;\r\n}\r\n\r\nconst gotTheLock = app.requestSingleInstanceLock();\r\nif (!gotTheLock) {\r\n\tapp.quit();\r\n} else {\r\n\tautoUpdater.checkForUpdates();\r\n\tautoUpdater.on('update-available', () => {\r\n\t\ttry {\r\n\t\t\tglobal.mainWindow?.webContents.send(IpcRendererMessages.AUTO_UPDATER_STATE, {\r\n\t\t\t\tstate: 'available',\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t/* Empty block */\r\n\t\t}\r\n\t});\r\n\tautoUpdater.on('error', (err: string) => {\r\n\t\ttry {\r\n\t\t\tglobal.mainWindow?.webContents.send(IpcRendererMessages.AUTO_UPDATER_STATE, {\r\n\t\t\t\tstate: 'error',\r\n\t\t\t\terror: err,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t/*empty*/\r\n\t\t}\r\n\t});\r\n\tautoUpdater.on('download-progress', (progress: ProgressInfo) => {\r\n\t\ttry {\r\n\t\t\tglobal.mainWindow?.webContents.send(IpcRendererMessages.AUTO_UPDATER_STATE, {\r\n\t\t\t\tstate: 'downloading',\r\n\t\t\t\tprogress,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t/*empty*/\r\n\t\t}\r\n\t});\r\n\tautoUpdater.on('update-downloaded', (info: UpdateInfo) => {\r\n\t\ttry {\r\n\t\t\tglobal.mainWindow?.webContents.send(IpcRendererMessages.AUTO_UPDATER_STATE, {\r\n\t\t\t\tstate: 'downloaded',\r\n\t\t\t\tinfo,\r\n\t\t\t});\r\n\t\t} catch (e) {\r\n\t\t\t/*empty*/\r\n\t\t}\r\n\t});\r\n\r\n\t// quit application when all windows are closed\r\n\tapp.on('window-all-closed', () => {\r\n\t\t// on macOS it is common for applications to stay open until the user explicitly quits\r\n\t\ttry {\r\n\t\t\tconst mainWindow = global.mainWindow;\r\n\t\t\tconst overlay = global.overlay;\r\n\t\t\tglobal.mainWindow = null;\r\n\t\t\tglobal.overlay = null;\r\n\t\t\toverlay?.close();\r\n\t\t\tmainWindow?.destroy();\r\n\t\t\toverlay?.destroy();\r\n\t\t} catch {\r\n\t\t\t/* empty */\r\n\t\t}\r\n\t\tapp.quit();\r\n\t});\r\n\r\n\tapp.on('activate', () => {\r\n\t\t// on macOS it is common to re-create a window even after all windows have been closed\r\n\t\tif (global.mainWindow === null) {\r\n\t\t\tglobal.mainWindow = createMainWindow();\r\n\t\t}\r\n\r\n\t\tsession.fromPartition('default').setPermissionRequestHandler((webContents, permission, callback) => {\r\n\t\t\tconst allowedPermissions = ['audioCapture']; // Full list here: https://developer.chrome.com/extensions/declare_permissions#manifest\r\n\t\t\tconsole.log('permission requested ', permission);\r\n\t\t\tif (allowedPermissions.includes(permission)) {\r\n\t\t\t\tcallback(true); // Approve permission request\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t`The application tried to request permission for '${permission}'. This permission was not whitelisted and has been blocked.`\r\n\t\t\t\t);\r\n\r\n\t\t\t\tcallback(false); // Deny\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\r\n\t// create main BrowserWindow when electron is ready\r\n\tapp.whenReady().then(() => {\r\n\t\tprotocol.registerFileProtocol('static', (request, callback) => {\r\n\t\t\tconst pathname = app.getPath('userData') + '/static/' + request.url.replace('static:///', '');\r\n\t\t\tcallback(pathname);\r\n\t\t});\r\n\r\n\t\tprotocol.registerFileProtocol('generate', async (request, callback) => {\r\n\t\t\tconst url = new URL(request.url.replace('generate:///', ''));\r\n\t\t\tconst path = await GenerateHat(url, gameReader.playercolors, Number(url.searchParams.get('color')), '');\r\n\t\t\tcallback(path);\r\n\t\t});\r\n\r\n\t\tinitializeIpcListeners();\r\n\t\tinitializeIpcHandlers();\r\n\t\tglobal.mainWindow = createMainWindow();\r\n\r\n\t\tif (isDevelopment)\r\n\t\t\tinstallExtension(REACT_DEVELOPER_TOOLS)\r\n\t\t\t\t.then((name: string) => console.log(`Added Extension:  ${name}`))\r\n\t\t\t\t.catch((err: string) => console.log('An error occurred: ', err));\r\n\t});\r\n\r\n\tapp.on('second-instance', () => {\r\n\t\t// Someone tried to run a second instance, we should focus our window.\r\n\t\tif (global.mainWindow) {\r\n\t\t\tif (global.mainWindow.isMinimized()) global.mainWindow.restore();\r\n\t\t\tglobal.mainWindow.focus();\r\n\t\t}\r\n\t});\r\n\r\n\tipcMain.on('update-app', () => {\r\n\t\tautoUpdater.quitAndInstall();\r\n\t});\r\n\r\n\tipcMain.on(IpcHandlerMessages.OPEN_LOBBYBROWSER, () => {\r\n\t\tif (!global.lobbyBrowser) {\r\n\t\t\tglobal.lobbyBrowser = createLobbyBrowser();\r\n\t\t} else {\r\n\t\t\tglobal.lobbyBrowser.show();\r\n\t\t\tglobal.lobbyBrowser.moveTop();\r\n\t\t}\r\n\t});\r\n\r\n\tipcMain.on('enableOverlay', async (_event, enable) => {\r\n\t\ttry {\r\n\t\t\tif (enable) {\r\n\t\t\t\tif (!global.overlay) {\r\n\t\t\t\t\tglobal.overlay = createOverlay();\r\n\t\t\t\t}\r\n\t\t\t\toverlayWindow.show();\r\n\t\t\t} else {\r\n\t\t\t\toverlayWindow.hide();\r\n\t\t\t\tif (global.overlay?.closable) {\r\n\t\t\t\t\toverlayWindow.stop();\r\n\t\t\t\t\tglobal.overlay?.close();\r\n\t\t\t\t\tglobal.overlay = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (exception) {\r\n\t\t\tglobal.overlay?.hide();\r\n\t\t\tglobal.overlay?.close();\r\n\t\t}\r\n\t});\r\n\r\n\tipcMain.on('enableOverlay', async (_event, enable) => {\r\n\t\tif (global.mainWindow) {\r\n\t\t\tglobal.mainWindow.setAlwaysOnTop(enable, 'screen-saver');\r\n\t\t}\r\n\t});\r\n\r\n\r\n}\r\n"]}